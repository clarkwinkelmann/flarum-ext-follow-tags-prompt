{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/follow-tags-prompt/webpack/bootstrap","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/define property getters","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/Model']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['tags/common/utils/sortTags']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['tags/common/helpers/tagIcon']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/components/ChooseTagsToFollowModal.ts","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/alterFollowingPage.ts","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Page']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/index.ts","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/openAutomaticModal.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/DiscussionListState'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/common/utils/sortTags'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/common/helpers/tagIcon'];","import app from 'flarum/forum/app';\nimport Modal, {IInternalModalAttrs} from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport Model from 'flarum/common/Model';\nimport sortTags from 'flarum/tags/common/utils/sortTags';\nimport tagIcon from 'flarum/tags/common/helpers/tagIcon';\n\nlet SubscriptionMenu: any;\nlet SubscriptionStateButton: any;\n\ninterface ChooseTagsToFollowModalAttrs extends IInternalModalAttrs {\n    hasNotChosenYet?: boolean\n}\n\n// @ts-ignore Flarum missing view method type-hint\nexport default class ChooseTagsToFollowModal extends Modal<ChooseTagsToFollowModalAttrs> {\n    className() {\n        return 'ChooseTagsToFollowModal';\n    }\n\n    title() {\n        return app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.modal.title');\n    }\n\n    content() {\n        // SubscriptionMenu is a component in Follow Tags <1.2.0\n        // This code is kept for now for backward-compatibility\n        const OriginalSubscriptionMenu = flarum.extensions['fof-follow-tags'] && flarum.extensions['fof-follow-tags'].components.SubscriptionMenu;\n\n        // If the extended class does not exist, create it\n        // We need to create it a single time, otherwise Mithril cannot know it's the same component\n        if (OriginalSubscriptionMenu && !SubscriptionMenu) {\n            SubscriptionMenu = class extends OriginalSubscriptionMenu {\n                view() {\n                    const vdom = super.view();\n\n                    // Remove .App-primaryControl class from dropdowns\n                    vdom.attrs.className = vdom.attrs.className.replace('App-primaryControl', '');\n\n                    return vdom;\n                }\n            }\n        }\n\n        // The state button and modal are the new components in Follow Tags 1.2.0\n        // Since the states are now extensible it would be crazy to re-implement a custom component\n        // Instead we'll open the native modal\n        // No issue since Flarum supports nested modals since 1.5\n        const {SubscriptionModal} = flarum.extensions['fof-follow-tags'] && flarum.extensions['fof-follow-tags'].components;\n        const OriginalSubscriptionStateButton = flarum.extensions['fof-follow-tags'] && flarum.extensions['fof-follow-tags'].components.SubscriptionStateButton;\n\n        if (OriginalSubscriptionStateButton && !SubscriptionStateButton) {\n            SubscriptionStateButton = class extends OriginalSubscriptionStateButton {\n                view() {\n                    const vdom = super.view();\n\n                    // Move tooltip to the right, so it doesn't block access to the button below\n                    if (typeof vdom === 'object' && vdom.tag === Tooltip && vdom.attrs) {\n                        vdom.attrs.position = 'right';\n                    }\n\n                    return vdom;\n                }\n            }\n        }\n\n        // Render the modal content if either the old backward-compatible component or the new ones are available\n        const supported = SubscriptionMenu || (SubscriptionStateButton && SubscriptionModal)\n\n        const tags = sortTags(Model.hasMany('clarkwinkelmannFollowTagsList').call(app.forum) as any || []);\n\n        return [\n            m('.Modal-body.ChooseTagsToFollowModal-scroll', supported ? m('table', m('tbody', tags.map(tag => m('tr', [\n                m('td.TagName', {\n                    style: {\n                        color: tag.color(),\n                    },\n                    onclick: (event: Event) => {\n                        $(event.target as HTMLElement).parents('tr').find('.SubscriptionMenu-button').trigger('click');\n                    },\n                }, [\n                    tagIcon(tag),\n                    tag.name(),\n                ]),\n                m('td.TagDescription', tag.description()),\n                m('td.TagFollow', SubscriptionMenu ? SubscriptionMenu.component({\n                    model: tag,\n                }) : SubscriptionStateButton.component({\n                    className: 'Button',\n                    // @ts-ignore additional method from Follow Tags is not type-hinted\n                    subscription: tag.subscription(),\n                    onclick() {\n                        app.modal.show(SubscriptionModal, {model: tag}, true);\n                    },\n                })),\n            ])))) : 'Error: Follow Tags is not enabled'),\n            m('.Modal-body.ChooseTagsToFollowModal-footer', [\n                this.attrs.hasNotChosenYet ? Button.component({\n                    className: 'Button Button--link',\n                    onclick() {\n                        app.modal.close();\n                    },\n                }, app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.modal.later')) : null,\n                Button.component({\n                    loading: this.loading,\n                    className: 'Button Button--primary',\n                    onclick: () => {\n                        // If we are not in the \"forced to choose\" mode, there's no need to send a request again\n                        // since it's already marked as done\n                        if (!this.attrs.hasNotChosenYet) {\n                            app.modal.close();\n                            return;\n                        }\n\n                        this.loading = true;\n\n                        app.session.user!.save({\n                            followTagsConfigured: true,\n                        }).then(() => {\n                            this.loading = false;\n                            m.redraw();\n                            app.modal.close();\n                        }).catch(err => {\n                            this.loading = false;\n                            m.redraw();\n                            throw err;\n                        });\n                    }\n                }, app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.modal.continue')),\n            ]),\n        ];\n    }\n\n    // @ts-ignore Missing event type-hint in Flarum\n    onsubmit(event: Event) {\n        // fof/follow-tags is using buttons without type, which cause the modal form to submit itself without this\n        event.preventDefault();\n    }\n}\n","import {extend} from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport Button from 'flarum/common/components/Button';\nimport ChooseTagsToFollowModal from './components/ChooseTagsToFollowModal';\n\n// Similar implementation to fof/follow-tags, but will work even if the Subscriptions extension is disabled\nfunction isFollowingPage() {\n    return app.current.get('routeName') === 'following';\n}\n\nexport default function () {\n    extend(DiscussionListState.prototype, 'requestParams', function (params) {\n        if (!isFollowingPage() || app.session.user || !app.forum.attribute('clarkwinkelmannFollowTagsPromptAllDiscussionsForGuests')) return;\n\n        // If this is the following page and we are guest, show all discussions like if it was the homepage\n        // That way the following page can be used as homepage without negative impact on guests\n        delete params.filter['following-tag'];\n        delete params.filter.subscription;\n    });\n\n    extend(IndexPage.prototype, 'viewItems', function (items) {\n        if (!isFollowingPage() || !app.session.user || !app.forum.attribute('clarkwinkelmannFollowTagsPromptButton')) return;\n\n        items.add(\n            'clarkwinkelmann-follow-tags-prompt',\n            Button.component({\n                className: 'Button Button--primary',\n                onclick() {\n                    app.modal.show(ChooseTagsToFollowModal);\n                },\n            }, app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.controls.choose')),\n            -10\n        );\n    });\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Page'];","import app from 'flarum/forum/app';\nimport alterFollowingPage from './alterFollowingPage';\nimport openAutomaticModal from './openAutomaticModal';\n\napp.initializers.add('clarkwinkelmann/follow-tags-prompt', () => {\n    alterFollowingPage();\n    openAutomaticModal();\n});\n","import app from 'flarum/forum/app';\nimport {extend} from 'flarum/common/extend';\nimport Page from 'flarum/common/components/Page';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport ChooseTagsToFollowModal from './components/ChooseTagsToFollowModal';\n\nexport default function () {\n    let initialized = false;\n\n    extend(Page.prototype, 'oninit', function () {\n        if (initialized) {\n            return;\n        }\n\n        // We only show the modal if the first page loaded was the index page\n        // And that new updates are available\n        // And that the user *must* accept them\n        if (\n            (app.current.matches(IndexPage) || m.route.get() === '/') &&\n            app.forum.attribute('clarkwinkelmannFollowTagsShouldPrompt')\n        ) {\n            // This code is affected by the blue backdrop of death https://github.com/flarum/core/issues/1813\n            // This can't be reliably reproduced, but happens mostly on Firefox\n            // setTimeout doesn't solve the issue but brings a slight improvement, so we'll go with that for now\n            setTimeout(() => app.modal.show(ChooseTagsToFollowModal, {\n                hasNotChosenYet: true,\n            }), 0);\n        }\n\n        initialized = true;\n    });\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","SubscriptionMenu","SubscriptionStateButton","ChooseTagsToFollowModal","_Modal","apply","arguments","_proto","className","title","app","trans","content","_this","OriginalSubscriptionMenu","extensions","components","_OriginalSubscription","view","vdom","attrs","replace","SubscriptionModal","OriginalSubscriptionStateButton","_OriginalSubscription2","tag","Tooltip","position","supported","tags","sortTags","Model","m","map","style","color","onclick","event","$","target","parents","find","trigger","tagIcon","name","description","component","model","subscription","show","this","hasNotChosenYet","Button","close","loading","user","save","followTagsConfigured","then","redraw","err","onsubmit","preventDefault","Modal","isFollowingPage","add","initialized","extend","DiscussionListState","params","attribute","filter","IndexPage","items","Page","matches","route","setTimeout"],"sourceRoot":""}