{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@clarkwinkelmann/follow-tags-prompt/webpack/bootstrap","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/define property getters","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['forum/app']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Button']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/Model']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['tags/utils/sortTags']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['tags/helpers/tagIcon']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/components/ChooseTagsToFollowModal.ts","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/alterFollowingPage.ts","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Page']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/index.ts","webpack://@clarkwinkelmann/follow-tags-prompt/./src/forum/openAutomaticModal.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/DiscussionListState'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/utils/sortTags'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/helpers/tagIcon'];","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\nimport Model from \"flarum/common/Model\";\nimport sortTags from 'flarum/tags/utils/sortTags';\nimport tagIcon from 'flarum/tags/helpers/tagIcon';\n\nlet SubscriptionMenu: any;\n\ninterface ChooseTagsToFollowModalAttrs {\n    hasNotChosenYet?: boolean\n}\n\n// @ts-ignore Flarum missing view method type-hint\nexport default class ChooseTagsToFollowModal extends Modal {\n    attrs!: ChooseTagsToFollowModalAttrs\n\n    className() {\n        return 'ChooseTagsToFollowModal';\n    }\n\n    title() {\n        return app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.modal.title');\n    }\n\n    content() {\n        const OriginalSubscriptionMenu = flarum.extensions['fof-follow-tags'] && flarum.extensions['fof-follow-tags'].components.SubscriptionMenu;\n\n        // If the extended class does not exist, create it\n        // We need to create it a single time, otherwise Mithril cannot know it's the same component\n        if (OriginalSubscriptionMenu && !SubscriptionMenu) {\n            SubscriptionMenu = class extends OriginalSubscriptionMenu {\n                view() {\n                    const vdom = super.view();\n\n                    // Remove .App-primaryControl class from dropdowns\n                    vdom.attrs.className = vdom.attrs.className.replace('App-primaryControl', '');\n\n                    return vdom;\n                }\n            }\n        }\n\n        const tags = sortTags(Model.hasMany('clarkwinkelmannFollowTagsList').call(app.forum));\n\n        return [\n            m('.Modal-body.ChooseTagsToFollowModal-scroll', SubscriptionMenu ? m('table', m('tbody', tags.map(tag => m('tr', [\n                m('td.TagName', {\n                    style: {\n                        color: tag.color(),\n                    },\n                    onclick: (event: Event) => {\n                        $(event.target as HTMLElement).parents('tr').find('.SubscriptionMenu-button').trigger('click');\n                    },\n                }, [\n                    tagIcon(tag),\n                    tag.name(),\n                ]),\n                m('td.TagDescription', tag.description()),\n                m('td.TagFollow', SubscriptionMenu.component({\n                    model: tag,\n                })),\n            ])))) : 'Error: Follow Tags is not enabled'),\n            m('.Modal-body.ChooseTagsToFollowModal-footer', [\n                this.attrs.hasNotChosenYet ? Button.component({\n                    className: 'Button Button--link',\n                    onclick() {\n                        app.modal.close();\n                    },\n                }, app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.modal.later')) : null,\n                Button.component({\n                    loading: this.loading,\n                    className: 'Button Button--primary',\n                    onclick: () => {\n                        // If we are not in the \"forced to choose\" mode, there's no need to send a request again\n                        // since it's already marked as done\n                        if (!this.attrs.hasNotChosenYet) {\n                            app.modal.close();\n                            return;\n                        }\n\n                        this.loading = true;\n\n                        app.session.user.save({\n                            followTagsConfigured: true,\n                        }).then(() => {\n                            this.loading = false;\n                            m.redraw();\n                            app.modal.close();\n                        }).catch(err => {\n                            this.loading = false;\n                            m.redraw();\n                            throw err;\n                        });\n                    }\n                }, app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.modal.continue')),\n            ]),\n        ];\n    }\n\n    // @ts-ignore Missing event type-hint in Flarum\n    onsubmit(event: Event) {\n        // fof/follow-tags is using buttons without type, which cause the modal form to submit itself without this\n        event.preventDefault();\n    }\n}\n","import {extend} from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nimport ChooseTagsToFollowModal from './components/ChooseTagsToFollowModal';\n\n// Similar implementation to fof/follow-tags, but will work even if the Subscriptions extension is disabled\nfunction isFollowingPage() {\n    return app.current.get('routeName') === 'following';\n}\n\nexport default function () {\n    extend(DiscussionListState.prototype, 'requestParams', function (params: any) {\n        if (!isFollowingPage() || app.session.user || !app.forum.attribute('clarkwinkelmannFollowTagsPromptAllDiscussionsForGuests')) return;\n\n        // If this is the following page and we are guest, show all discussions like if it was the homepage\n        // That way the following page can be used as homepage without negative impact on guests\n        delete params.filter['following-tag'];\n        delete params.filter.subscription;\n    });\n\n    extend(IndexPage.prototype, 'viewItems', function (items: ItemList) {\n        if (!isFollowingPage() || !app.session.user || !app.forum.attribute('clarkwinkelmannFollowTagsPromptButton')) return;\n\n        items.add(\n            'clarkwinkelmann-follow-tags-prompt',\n            Button.component({\n                className: 'Button Button--primary',\n                onclick() {\n                    app.modal.show(ChooseTagsToFollowModal, { /* Flarum type-hints require attrs */});\n                },\n            }, app.translator.trans('clarkwinkelmann-follow-tags-prompt.forum.controls.choose')),\n            -10\n        );\n    });\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Page'];","import app from 'flarum/forum/app';\nimport alterFollowingPage from './alterFollowingPage';\nimport openAutomaticModal from './openAutomaticModal';\n\napp.initializers.add('clarkwinkelmann/follow-tags-prompt', () => {\n    alterFollowingPage();\n    openAutomaticModal();\n});\n","import app from 'flarum/forum/app';\nimport {extend} from 'flarum/common/extend';\nimport Page from 'flarum/common/components/Page';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport ChooseTagsToFollowModal from './components/ChooseTagsToFollowModal';\n\nexport default function () {\n    let initialized = false;\n\n    extend(Page.prototype, 'oninit', function () {\n        if (initialized) {\n            return;\n        }\n\n        // We only show the modal if the first page loaded was the index page\n        // And that new updates are available\n        // And that the user *must* accept them\n        if (\n            (app.current.matches(IndexPage) || m.route.get() === '/') &&\n            app.forum.attribute('clarkwinkelmannFollowTagsShouldPrompt')\n        ) {\n            // This code is affected by the blue backdrop of death https://github.com/flarum/core/issues/1813\n            // This can't be reliably reproduced, but happens mostly on Firefox\n            // setTimeout doesn't solve the issue but brings a slight improvement, so we'll go with that for now\n            setTimeout(() => app.modal.show(ChooseTagsToFollowModal, {\n                hasNotChosenYet: true,\n            }), 0);\n        }\n\n        initialized = true;\n    });\n}\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","__proto__","_inheritsLoose","subClass","superClass","create","constructor","SubscriptionMenu","ChooseTagsToFollowModal","attrs","className","title","app","content","OriginalSubscriptionMenu","extensions","components","view","vdom","replace","tags","sortTags","Model","m","map","tag","style","color","onclick","event","$","target","parents","find","trigger","tagIcon","name","description","component","model","this","hasNotChosenYet","Button","loading","followTagsConfigured","then","redraw","err","onsubmit","preventDefault","Modal","isFollowingPage","initialized","extend","DiscussionListState","params","filter","subscription","IndexPage","items","add","Page","route","setTimeout"],"sourceRoot":""}