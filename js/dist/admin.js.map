{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@clarkwinkelmann/follow-tags-prompt/webpack/bootstrap","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/define property getters","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['admin/app']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['admin/components/BasicsPage']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Select']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['tags/utils/sortTags']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./src/admin/components/SettingsPage.ts","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/follow-tags-prompt/./src/admin/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/BasicsPage'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Select'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/utils/sortTags'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","import {Vnode} from 'mithril';\nimport app from 'flarum/admin/app';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport Select from 'flarum/common/components/Select';\nimport Switch from 'flarum/common/components/Switch';\nimport sortTags from 'flarum/tags/utils/sortTags';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\n\nconst settingsPrefix = 'clarkwinkelmann-follow-tags-prompt.';\nconst translationPrefix = 'clarkwinkelmann-follow-tags-prompt.admin.settings.';\n\n// @ts-ignore missing view type-hint\nexport default class SettingsPage extends ExtensionPage {\n    allTagsLoaded: boolean = false\n    loadingAllTags: boolean = false\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        if (this.setting(settingsPrefix + 'availableTagStrategy')() === 'list') {\n            this.loadAllTags();\n        }\n    }\n\n    loadAllTags() {\n        this.loadingAllTags = true;\n\n        // Only the primary tags are loaded by default, so we need to make the same request that\n        // the tags page settings does to load the full list\n        app.store.find('tags', {include: 'parent,lastPostedDiscussion'}).then(() => {\n            this.loadingAllTags = false;\n            this.allTagsLoaded = true;\n\n            m.redraw();\n        });\n    }\n\n    content() {\n        return m('.ExtensionPage-settings', m('.container', [\n            m('.Form-group', [\n                m('label', Switch.component({\n                    state: this.setting(settingsPrefix + 'buttonOnFollowingPage', '1')() === '1',\n                    onchange: (value: boolean) => {\n                        this.setting(settingsPrefix + 'buttonOnFollowingPage')(value ? '1' : '0');\n                    },\n                }, app.translator.trans(translationPrefix + 'buttonOnFollowingPage'))),\n            ]),\n            m('.Form-group', [\n                m('label', Switch.component({\n                    state: this.setting(settingsPrefix + 'allDiscussionsOnFollowingPageForGuests')() === '1',\n                    onchange: (value: boolean) => {\n                        this.setting(settingsPrefix + 'allDiscussionsOnFollowingPageForGuests')(value ? '1' : '0');\n                    },\n                }, app.translator.trans(translationPrefix + 'allDiscussionsOnFollowingPageForGuests'))),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans(translationPrefix + 'availableTagStrategy')),\n                Select.component({\n                    options: {\n                        primary: app.translator.trans(translationPrefix + 'tagStrategy.primary'),\n                        primaryAndChildren: app.translator.trans(translationPrefix + 'tagStrategy.primaryAndChildren'),\n                        primaryAndSecondary: app.translator.trans(translationPrefix + 'tagStrategy.primaryAndSecondary'),\n                        secondary: app.translator.trans(translationPrefix + 'tagStrategy.secondary'),\n                        all: app.translator.trans(translationPrefix + 'tagStrategy.all'),\n                        list: app.translator.trans(translationPrefix + 'tagStrategy.list'),\n                    },\n                    value: this.setting(settingsPrefix + 'availableTagStrategy')() || 'primary',\n                    onchange: (value: string) => {\n                        if (value === 'list' && !this.allTagsLoaded && !this.loadingAllTags) {\n                            this.loadAllTags();\n                        }\n\n                        this.setting(settingsPrefix + 'availableTagStrategy')(value);\n                    },\n                }),\n            ]),\n            this.tagList(),\n            m('.Form-group', this.submitButton()),\n        ]));\n    }\n\n    tagList() {\n        if (this.setting(settingsPrefix + 'availableTagStrategy')() !== 'list') {\n            return null;\n        }\n\n        if (this.loadingAllTags) {\n            return LoadingIndicator.component();\n        }\n\n        let tagIds: string[] = [];\n\n        try {\n            tagIds = JSON.parse(this.setting(settingsPrefix + 'availableTagIds')() || '[]');\n        } catch (e) {\n            console.warn('Could not parse existing value for ' + settingsPrefix + 'availableTagIds', e);\n        }\n\n        if (!Array.isArray(tagIds)) {\n            tagIds = [];\n        }\n\n        return sortTags(app.store.all('tags')).map(tag => {\n            const state = tagIds.indexOf(tag.id()) !== -1;\n\n            return m('.Form-group', [\n                m('label', Switch.component({\n                    state,\n                    onchange: (value: boolean) => {\n                        this.setting(settingsPrefix + 'availableTagIds')(JSON.stringify(value ?\n                            [...tagIds, tag.id()] :\n                            tagIds.filter(id => id !== tag.id())\n                        ));\n                    },\n                }, tag.name())),\n            ]);\n        });\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import app from 'flarum/admin/app';\nimport {extend} from 'flarum/common/extend';\nimport BasicsPage from 'flarum/admin/components/BasicsPage';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport SettingsPage from './components/SettingsPage';\n\napp.initializers.add('clarkwinkelmann/follow-tags-prompt', () => {\n    app.extensionData\n        .for('clarkwinkelmann-follow-tags-prompt')\n        .registerPage(SettingsPage);\n\n    // Because neither flarum/subscription nor fof/follow-tags does it, we do it here\n    extend(BasicsPage.prototype, 'homePageItems', function (items: ItemList) {\n        items.add('clarkwinkelmann-following-tags-prompt', {\n            path: '/following',\n            label: app.translator.trans('clarkwinkelmann-follow-tags-prompt.admin.homepage.following'),\n        });\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","__proto__","settingsPrefix","translationPrefix","SettingsPage","subClass","superClass","allTagsLoaded","loadingAllTags","create","constructor","oninit","vnode","this","setting","loadAllTags","app","include","then","m","redraw","content","Switch","state","onchange","Select","options","primary","primaryAndChildren","primaryAndSecondary","secondary","all","list","tagList","submitButton","LoadingIndicator","tagIds","JSON","parse","e","console","warn","Array","isArray","sortTags","map","tag","indexOf","id","stringify","filter","name","ExtensionPage","registerPage","extend","BasicsPage","items","add","path","label"],"sourceRoot":""}