{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@clarkwinkelmann/follow-tags-prompt/webpack/bootstrap","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/compat get default export","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/define property getters","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/hasOwnProperty shorthand","webpack://@clarkwinkelmann/follow-tags-prompt/webpack/runtime/make namespace object","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['admin/app']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/extend']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['admin/components/BasicsPage']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['admin/components/ExtensionPage']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Select']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['tags/common/utils/sortTags']\"","webpack://@clarkwinkelmann/follow-tags-prompt/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@clarkwinkelmann/follow-tags-prompt/./src/admin/components/SettingsPage.ts","webpack://@clarkwinkelmann/follow-tags-prompt/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@clarkwinkelmann/follow-tags-prompt/./src/admin/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/BasicsPage'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/components/ExtensionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Select'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/common/utils/sortTags'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","import {Vnode} from 'mithril';\nimport app from 'flarum/admin/app';\nimport ExtensionPage from 'flarum/admin/components/ExtensionPage';\nimport Select from 'flarum/common/components/Select';\nimport Switch from 'flarum/common/components/Switch';\nimport sortTags from 'flarum/tags/common/utils/sortTags';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\n\nconst settingsPrefix = 'clarkwinkelmann-follow-tags-prompt.';\nconst translationPrefix = 'clarkwinkelmann-follow-tags-prompt.admin.settings.';\n\n// @ts-ignore missing view type-hint\nexport default class SettingsPage extends ExtensionPage {\n    allTagsLoaded: boolean = false\n    loadingAllTags: boolean = false\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        if (this.setting(settingsPrefix + 'availableTagStrategy')() === 'list') {\n            this.loadAllTags();\n        }\n    }\n\n    loadAllTags() {\n        this.loadingAllTags = true;\n\n        // Only the primary tags are loaded by default, so we need to make the same request that\n        // the tags page settings does to load the full list\n        app.store.find('tags', {include: 'parent,lastPostedDiscussion'}).then(() => {\n            this.loadingAllTags = false;\n            this.allTagsLoaded = true;\n\n            m.redraw();\n        });\n    }\n\n    content() {\n        return m('.ExtensionPage-settings', m('.container', [\n            m('.Form-group', [\n                m('label', Switch.component({\n                    state: this.setting(settingsPrefix + 'buttonOnFollowingPage', '1')() === '1',\n                    onchange: (value: boolean) => {\n                        this.setting(settingsPrefix + 'buttonOnFollowingPage')(value ? '1' : '0');\n                    },\n                }, app.translator.trans(translationPrefix + 'buttonOnFollowingPage'))),\n            ]),\n            m('.Form-group', [\n                m('label', Switch.component({\n                    state: this.setting(settingsPrefix + 'allDiscussionsOnFollowingPageForGuests')() === '1',\n                    onchange: (value: boolean) => {\n                        this.setting(settingsPrefix + 'allDiscussionsOnFollowingPageForGuests')(value ? '1' : '0');\n                    },\n                }, app.translator.trans(translationPrefix + 'allDiscussionsOnFollowingPageForGuests'))),\n            ]),\n            m('.Form-group', [\n                m('label', app.translator.trans(translationPrefix + 'availableTagStrategy')),\n                Select.component({\n                    options: {\n                        primary: app.translator.trans(translationPrefix + 'tagStrategy.primary'),\n                        primaryAndChildren: app.translator.trans(translationPrefix + 'tagStrategy.primaryAndChildren'),\n                        primaryAndSecondary: app.translator.trans(translationPrefix + 'tagStrategy.primaryAndSecondary'),\n                        secondary: app.translator.trans(translationPrefix + 'tagStrategy.secondary'),\n                        all: app.translator.trans(translationPrefix + 'tagStrategy.all'),\n                        list: app.translator.trans(translationPrefix + 'tagStrategy.list'),\n                    },\n                    value: this.setting(settingsPrefix + 'availableTagStrategy')() || 'primary',\n                    onchange: (value: string) => {\n                        if (value === 'list' && !this.allTagsLoaded && !this.loadingAllTags) {\n                            this.loadAllTags();\n                        }\n\n                        this.setting(settingsPrefix + 'availableTagStrategy')(value);\n                    },\n                }),\n            ]),\n            this.tagList(),\n            m('.Form-group', this.submitButton()),\n        ]));\n    }\n\n    tagList() {\n        if (this.setting(settingsPrefix + 'availableTagStrategy')() !== 'list') {\n            return null;\n        }\n\n        if (this.loadingAllTags) {\n            return LoadingIndicator.component();\n        }\n\n        let tagIds: string[] = [];\n\n        try {\n            tagIds = JSON.parse(this.setting(settingsPrefix + 'availableTagIds')() || '[]');\n        } catch (e) {\n            console.warn('Could not parse existing value for ' + settingsPrefix + 'availableTagIds', e);\n        }\n\n        if (!Array.isArray(tagIds)) {\n            tagIds = [];\n        }\n\n        return sortTags(app.store.all('tags')).map(tag => {\n            const state = tagIds.indexOf(tag.id()!) !== -1;\n\n            return m('.Form-group', [\n                m('label', Switch.component({\n                    state,\n                    onchange: (value: boolean) => {\n                        this.setting(settingsPrefix + 'availableTagIds')(JSON.stringify(value ?\n                            [...tagIds, tag.id()] :\n                            tagIds.filter(id => id !== tag.id())\n                        ));\n                    },\n                }, tag.name())),\n            ]);\n        });\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import app from 'flarum/admin/app';\nimport {extend} from 'flarum/common/extend';\nimport BasicsPage from 'flarum/admin/components/BasicsPage';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport SettingsPage from './components/SettingsPage';\n\napp.initializers.add('clarkwinkelmann/follow-tags-prompt', () => {\n    app.extensionData\n        .for('clarkwinkelmann-follow-tags-prompt')\n        .registerPage(SettingsPage);\n\n    // Because neither flarum/subscription nor fof/follow-tags does it, we do it here\n    extend(BasicsPage.prototype, 'homePageItems', function (items: ItemList) {\n        items.add('clarkwinkelmann-following-tags-prompt', {\n            path: '/following',\n            label: app.translator.trans('clarkwinkelmann-follow-tags-prompt.admin.homepage.following'),\n        });\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","settingsPrefix","translationPrefix","SettingsPage","_ExtensionPage","subClass","superClass","_this","_len","arguments","length","args","Array","_key","apply","concat","allTagsLoaded","loadingAllTags","create","constructor","_proto","oninit","vnode","this","setting","loadAllTags","_this2","app","find","include","then","m","redraw","content","_this3","Switch","state","onchange","trans","Select","options","primary","primaryAndChildren","primaryAndSecondary","secondary","all","list","tagList","submitButton","_this4","LoadingIndicator","tagIds","JSON","parse","e","console","warn","isArray","sortTags","map","tag","indexOf","id","stringify","filter","name","ExtensionPage","add","registerPage","extend","BasicsPage","items","path","label"],"sourceRoot":""}